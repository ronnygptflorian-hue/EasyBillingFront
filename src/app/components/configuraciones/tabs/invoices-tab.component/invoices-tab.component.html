<div class="config-section">
  <div class="section-header">
    <div>
      <h2>Secuencias de Comprobantes Fiscales</h2>
      <p class="section-description">Gestiona las secuencias NCF autorizadas por DGII</p>
    </div>
    <button class="btn btn-primary" (click)="openModal()">
      <span>‚ûï</span>
      Nueva Secuencia
    </button>
  </div>

  <div class="loading-state" *ngIf="loading">
    <div class="spinner"></div>
    <p>Cargando secuencias...</p>
  </div>

  <div class="empty-state" *ngIf="!loading && secuencias.length === 0">
    <div class="empty-icon">üìã</div>
    <h3>No hay secuencias configuradas</h3>
    <p>Agrega tu primera secuencia de comprobantes fiscales</p>
    <button class="btn btn-primary" (click)="openModal()">
      <span>‚ûï</span>
      Agregar Primera Secuencia
    </button>
  </div>

  <div class="table-container" *ngIf="!loading && secuencias.length > 0">
    <table class="secuencias-table">
      <thead>
        <tr>
          <th>Tipo</th>
          <th>Descripci√≥n</th>
          <th>Rango</th>
          <th>Disponibles</th>
          <th>Uso</th>
          <th>Expiraci√≥n</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let sec of secuencias"
          [class.row-blocked]="sec.bloqueado"
          [class.row-expired]="isExpired(sec)"
          [class.row-warning]="isNearExpiry(sec)">
          <td class="tipo-cell">
            <span class="tipo-badge">{{ getTipoCodigo(sec.idTipoEcf) }}</span>
          </td>
          <td class="descripcion-cell">{{ sec.descripcionTipoEcf }}</td>
          <td class="rango-cell">
            <div class="rango-info">
              <span class="rango-text">{{ sec.inicioSecuencia }} - {{ sec.finSecuencia }}</span>
              <span class="actual-text">Actual: {{ formatSecuencia(sec) }}</span>
            </div>
          </td>
          <td class="disponibles-cell">
            <span class="disponibles-number">{{ getDisponibles(sec) }}</span>
          </td>
          <td class="uso-cell">
            <div class="uso-container">
              <span class="uso-text">{{ getPorcentajeUsado(sec) }}%</span>
              <div class="progress-bar-mini">
                <div class="progress-fill-mini"
                  [style.width.%]="getPorcentajeUsado(sec)"
                  [class.warning]="getPorcentajeUsado(sec) > 80"
                  [class.danger]="getPorcentajeUsado(sec) > 95">
                </div>
              </div>
            </div>
          </td>
          <td class="expiracion-cell">
            <span [class.expired-text]="isExpired(sec)">
              {{ formatDate(sec.fechaExpiracion) }}
            </span>
            <span class="alert-icon" *ngIf="isNearExpiry(sec) && !isExpired(sec)">‚ö†Ô∏è</span>
          </td>
          <td class="estado-cell">
            <span class="status-badge"
              [class.status-active]="!sec.bloqueado && !isExpired(sec)"
              [class.status-blocked]="sec.bloqueado"
              [class.status-expired]="isExpired(sec)">
              {{ getEstado(sec) }}
            </span>
          </td>
          <td class="acciones-cell">
            <div class="action-buttons">
              <button class="btn-icon" (click)="editSecuencia(sec)" title="Editar">
                ‚úèÔ∏è
              </button>
              <label class="toggle-switch-mini" title="Bloquear/Desbloquear">
                <input type="checkbox" [checked]="!sec.bloqueado"
                  (change)="toggleBloqueo(sec)" />
                <span class="slider-mini"></span>
              </label>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="pagination-container">
      <div class="pagination-info">
        <span>Mostrando {{ (pageIndex - 1) * pageSize + 1 }} - {{ Math.min(pageIndex * pageSize, totalRecords) }} de {{ totalRecords }} registros</span>
        <div class="page-size-selector">
          <label>Mostrar:</label>
          <select [(ngModel)]="pageSize" (change)="changePageSize(pageSize)" class="page-size-select">
            <option [value]="5">5</option>
            <option [value]="10">10</option>
            <option [value]="25">25</option>
            <option [value]="50">50</option>
          </select>
        </div>
      </div>

      <div class="pagination-controls">
        <button class="pagination-btn" [disabled]="!hasPreviousPage" (click)="previousPage()">
          ‚Äπ Anterior
        </button>

        <button *ngFor="let page of visiblePages"
          class="pagination-number"
          [class.active]="page === pageIndex"
          (click)="goToPage(page)">
          {{ page }}
        </button>

        <button class="pagination-btn" [disabled]="!hasNextPage" (click)="nextPage()">
          Siguiente ‚Ä∫
        </button>
      </div>
    </div>
  </div>

  
</div>

<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ isEditing ? 'Editar' : 'Nueva' }} Secuencia NCF</h2>
      <button (click)="closeModal()" class="btn-close">‚úï</button>
    </div>

    <form (ngSubmit)="saveSecuencia()" class="modal-body">
      <div class="form-group">
        <label>Tipo de Comprobante <span class="required">*</span></label>
        <select class="form-control" [(ngModel)]="currentSecuencia.idTipoEcf"
          name="tipoEcf" required>
          <option *ngFor="let tipo of tiposEcf" [value]="tipo.id">
            {{ tipo.codigo }} - {{ tipo.descripcion }}
          </option>
        </select>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Inicio Secuencia <span class="required">*</span></label>
          <input type="number" class="form-control"
            [(ngModel)]="currentSecuencia.inicioSecuencia"
            name="inicioSecuencia" required min="1" />
        </div>

        <div class="form-group">
          <label>Fin Secuencia <span class="required">*</span></label>
          <input type="number" class="form-control"
            [(ngModel)]="currentSecuencia.finSecuencia"
            name="finSecuencia" required min="1" />
        </div>
      </div>

      <div class="form-group">
        <label>Fecha de Expiraci√≥n <span class="required">*</span></label>
        <app-custom-datepicker
          [(ngModel)]="currentSecuencia.fechaExpiracion"
          name="fechaExpiracion"
          placeholder="Seleccionar fecha"
        ></app-custom-datepicker>
      </div>

      <div class="form-group">
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="currentSecuencia.bloqueado"
            name="bloqueado" />
          <span>Bloquear secuencia</span>
        </label>
      </div>

      <div class="modal-footer">
        <button type="button" (click)="closeModal()" class="btn btn-secondary">
          Cancelar
        </button>
        <button type="submit" class="btn btn-primary">
          <span>üíæ</span>
          {{ isEditing ? 'Actualizar' : 'Guardar' }}
        </button>
      </div>
    </form>
  </div>
</div>
